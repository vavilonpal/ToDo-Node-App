### Лабораторная работа №2
Студент: Алексеев Сергей. <br>
Группа: IA-2303
***
Цель работы
***
1. Научиться проектировать и реализовывать REST API с несколькими связанными сущностями.
2. Освоить работу с PostgreSQL в приложении на Node.js + Express с использованием ORM или сырых SQL-запросов.
3. Реализовать корректные операции CRUD, а также фильтрацию, сортировку и пагинацию.
4. Освоить принципы работы связей «один ко многим» (1:N) в реляционных базах данных.

### Шаг 1. Создание базы данных

Используя миграции, создаём две таблицы:

- Таблица `todos` для хранения задач.
- Таблица `categories` для хранения категорий задач.

``PS C:\Users\admin\WebstormProjects\todoapp> npx sequelize-cli migration:generate --name create-categories``
``PS C:\Users\admin\WebstormProjects\todoapp> npx sequelize-cli migration:generate --name create-todos``

### Шаг 3. Реализация API

Реализован RESTful API для работы с задачами и категориями.

API должен поддерживает следующие операции:

#### Для категорий

| Метод    | URL                   | Описание                       | Код       |
| -------- | --------------------- | ------------------------------ | --------- |
| `GET`    | `/api/categories`     | Получить список всех категорий | 200       |
| `GET`    | `/api/categories/:id` | Получить категорию по ID       | 200 / 404 |
| `POST`   | `/api/categories`     | Создать категорию (`name`)     | 201       |
| `PUT`    | `/api/categories/:id` | Изменить название категории    | 200 / 404 |
| `DELETE` | `/api/categories/:id` | Удалить категорию              | 204 / 404 |

```js
router.get('/', controller.getAllCategories);
router.get('/:id', controller.getCategoryById);
router.post('/', controller.createCategory);
router.put('/:id', controller.updateCategory);
router.delete('/:id', controller.deleteCategory);
```
#### Для задач

| Метод    | URL                     | Описание                                              | Код       |
| -------- | ----------------------- | ----------------------------------------------------- | --------- |
| `GET`    | `/api/todos`            | Список задач (с фильтрацией, поиском и пагинацией)    | 200       |
| `GET`    | `/api/todos/:id`        | Получить задачу по ID                                 | 200 / 404 |
| `POST`   | `/api/todos`            | Создать задачу (`title`, `category_id`)               | 201       |
| `PUT`    | `/api/todos/:id`        | Изменить задачу (`title`, `completed`, `category_id`) | 200 / 404 |
| `PATCH`  | `/api/todos/:id/toggle` | Переключить статус `completed`                        | 200 / 404 |
| `DELETE` | `/api/todos/:id`        | Удалить задачу                                        | 204 / 404 |

```js
router.get('/', todoController.getAllTodos);
router.get('/:id', todoController.getTodoById);
router.post('/', createTodoValidator, validate, todoController.createTodo);
router.put('/:id', updateTodoValidator, validate, todoController.updateTodo);
router.patch('/:id/toggle', todoController.toggleTodo);
router.delete('/:id', todoController.deleteTodo);
```

#### Example of response
```json
{
  "id": "b4750457-bb3d-4283-a6f4-059431bad922",
  "title": "Купить молоко",
  "completed": false,
  "due_date": null,
  "created_at": "2025-10-26T18:40:12.411Z",
  "updated_at": "2025-10-26T18:40:12.411Z",
  "category_id": 1,
  "category": {
    "id": 1,
    "name": "Покупки",
    "created_at": "2025-10-26T18:40:12.401Z",
    "updated_at": "2025-10-26T18:40:12.401Z"
  }
}
```

### Шаг 4. Дополнительные задания. Фильтрация, поиск и пагинация

## Контрольные вопросы

### 1. Что такое реляционная база данных и какие преимущества она предоставляет?

Реляционная база данных — это система хранения данных, основанная на таблицах, связанных между собой с помощью ключей.
**Преимущества:**

* Структурированное хранение данных
* Поддержка связей и целостности
* Возможность выполнения сложных запросов (SQL)
* Минимизация дублирования данных

---

### 2. Какие типы связей между таблицами существуют в реляционных базах данных?

Основные типы связей:

* **Один к одному (1:1)** — каждой записи одной таблицы соответствует одна запись другой.
* **Один ко многим (1:N)** — одной записи соответствует множество записей в другой таблице.
* **Многие ко многим (M:N)** — множество записей связано с множеством других через промежуточную таблицу.

---

### 3. Что такое RESTful API и для чего он используется?

RESTful API — это архитектурный стиль взаимодействия клиент-сервер, использующий стандартные HTTP-методы (GET, POST, PUT, DELETE).
**Назначение:**
Позволяет клиентам (веб, мобильным приложениям) взаимодействовать с сервером для получения и изменения данных.

---

### 4. Что такое SQL-инъекция и как защититься от неё?

SQL-инъекция — это уязвимость, при которой злоумышленник вставляет вредоносный SQL-код в запрос.
**Защита:**

* Использовать параметризованные запросы или ORM
* Не конкатенировать пользовательские данные в SQL
* Проверять и экранировать ввод

---

### 5. В чем разница между ORM и сырыми SQL-запросами? Какие преимущества и недостатки у каждого подхода?

* **ORM (Object-Relational Mapping):**
  Преимущества — удобство, меньше кода, защита от SQL-инъекций.
  Недостатки — меньшая производительность, ограниченная гибкость.

* **Сырые SQL-запросы:**
  Преимущества — максимальный контроль, высокая производительность.
  Недостатки — больше кода, риск SQL-инъекций, сложнее сопровождать.
